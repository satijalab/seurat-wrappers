---
title: "Analyzing Seurat data using fastTopics"
date: 'Compiled: `r format(Sys.Date(), "%B %d, %Y")`'
output:
  github_document:
    html_preview: true
  html_document:
    df_print: kable
    highlight: textmate
    theme: readable
---

*Add introductory text here.*

*Point to the fastTopics website and vignettes.*

*Add citation here.*

```{r knitr-opts, include=FALSE}
knitr::opts_chunk$set(comment = "#",collapse = TRUE,results = "hold",
                      fig.align = "center",dpi = 120)
```

We begin by loading the packages used to perform the analysis.

```{r load-pkgs, message=FALSE, warning=FALSE}
library(Seurat)
library(SeuratData)
library(SeuratWrappers)
library(fastTopics)
```

We set the seed so that the results can be reproduced.

```{r set-seed}
set.seed(1)
```

Load---and, if necessary, install---the PBMC 3k data set containing
transcription profiles for 2,700 cells.

```{r load-data, warning=FALSE}
InstallData("pbmc3k")
data(pbmc3k)
dim(GetAssayData(pbmc3k))
```

Fit the multinomial topic model to the raw UMI counts---*no
pre-processing or pre-selection of genes is needed.* Note that it may
take several minutes to complete this model fitting step.

```{r fit-model, results="hide", cache=TRUE}
pbmc3k <- FitTopicModel(pbmc3k,k = 6)
```

To fit a topic model, we must specify $K$, the number of topics.
Here, we have chosen $K = 6$ topics. In most settings, a good choice
of $K$ will not be known in advance, so you will you want to explore
the results from topic models at different settings of $K$.

This plot shows the cells projected onto the top two principal
components (PCs) obtained from the topic mixture proportions.

```{r pca-1, fig.width=4, fig.height=3}
Idents(pbmc3k) <- pbmc3k$seurat_annotations
DimPlot(pbmc3k,reduction = "pca_topics",pt.size = 1)
```

Compare this against PCs 1 and 2 of the transformed counts:

```{r pca-2, fig.width=4, fig.height=3}
pbmc3k <- FindVariableFeatures(pbmc3k)
pbmc3k <- ScaleData(pbmc3k)
pbmc3k <- RunPCA(pbmc3k)
DimPlot(pbmc3k,reduction = "pca",pt.size = 1)
```

Once fitted topic model is extracted, many functions from the
fastTopics package can be used for analysis and visualization. For
example, the Structure plot provides an evocative visual summary of
the estimated mixture proportions for each cell.

```{r structure-plot, fig.width=7.5, fig.height=2}
fit <- Misc(Reductions(pbmc3k,"multinom_topic_model"))
structure_plot(fit,grouping = Idents(pbmc3k),gap = 25)
```

This is the version of R and the packages that were used to generate
these results.

```{r session-info}
sessionInfo()
```
